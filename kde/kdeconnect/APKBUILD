# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=kdeconnect
pkgver=1.3.2_git20181030
pkgrel=0
_commit="e6d84ece344c06c71af279808824b53e2c2fa237"
pkgdesc="Adds communication between KDE and your smartphone"
url="https://community.kde.org/KDEConnect"
arch="all"
license="GPL-2.0"
depends="kirigami2 kde-cli-tools"
makedepends="extra-cmake-modules kdoctools-dev kconfigwidgets-dev kdbusaddons-dev kiconthemes-dev
		knotifications-dev kio-dev kcmutils-dev qca-qt5-dev plasma-framework-dev libexecinfo-dev
		qt5-qtdeclarative-dev"
subpackages="$pkgname-doc" #$pkgname-lang is only available in the release package
#source="https://download.kde.org/stable/$pkgname/$pkgver/src/$pkgname-kde-$pkgver.tar.xz"
source="https://github.com/kde/kdeconnect-kde/archive/$_commit.tar.gz"
options="!check" # Requires running X11 server
builddir="$srcdir/$pkgname-kde-$_commit"

build() {
	cd "$builddir"
	cmake \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_TESTING=ON \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_INSTALL_LIBEXECDIR=lib \
		-DEXPERIMENTALAPP_ENABLED=true \
		-DBUILD_TYPE=Release
	make
}

check() {
	cd "$builddir"
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="f3ea9cb790f7796afadae0f28cf018786e2abe3109c22474f5885351747742447f9aa3b9cf9c7380024a9fa3ab4d8cfde7e48054bb67c683266a42ccb4ed7b67  e6d84ece344c06c71af279808824b53e2c2fa237.tar.gz"
