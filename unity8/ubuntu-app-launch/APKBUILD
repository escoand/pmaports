# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer:
pkgname=ubuntu-app-launch
pkgver=0_git20181225
pkgrel=0
_commit="e779f6f32acb6b6c7cde205dcc0bd46f7a9f2674"
pkgdesc="Session init system job for Launching Applications"
arch="all"
url="https://unity8.io"
license="GPL-3.0"
depends="libertine"
depends_dev="gobject-introspection-dev lttng-ust-dev json-glib-dev zeitgeist-dev unity-api-dev curl-dev properties-cpp-dev"
makedepends="$depends_dev cmake dbus-test-runner qt5-qtdeclarative gtest-dev glib-dev mir-dev"
source="$pkgname-$_commit.tar.gz::https://github.com/ubports/$pkgname/archive/$_commit.tar.gz"
subpackages="$pkgname-dev"
builddir="$srcdir/$pkgname-$_commit"

prepare() {
	default_prepare

	# Don't build tests, undefined references
	truncate -s 0 "$builddir"/tests/CMakeLists.txt
}

build() {
	cmake \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib
	make
}

check() {
	cd "$builddir"
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="434712e888a434039b5d23271a5a11dca87c22bb4e807efb6cc4cd9edeace8ca0da59a4d68531881de3372ba9d65c209ae805f44a5b313228894025fd12dae66  ubuntu-app-launch-e779f6f32acb6b6c7cde205dcc0bd46f7a9f2674.tar.gz"
