pkgname=wlroots
pkgver=0_git20180524
pkgrel=0
_commit="9c439ce9cba8cf5a222ff6a1f1cf6d0d838acc81"
pkgdesc="Pluggable, composable modules for building a Wayland compositor, with Purism hacks to support Phosh"
arch="all"
url="https://code.puri.sm/Librem5/wlroots"
license="GPL2"
depends="wayland wayland-protocols"
depends_dev="libinput-dev xcb-util-image-dev"
makedepends="$depends_dev meson ninja mesa-dev eudev-dev pixman-dev wayland-dev libxkbcommon-dev"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://code.puri.sm/Librem5/wlroots/archive/$_commit.tar.gz"

builddir="$srcdir/$pkgname"

build() {
	cd "$builddir"
	meson . _build --prefix=/usr
	ninja -C _build
}

package() {
	cd "$builddir"
	
	DESTDIR="$pkgdir/" ninja -C _build install

	# This breaks for some reason. However, we do need this binary to run Phosh
	# Log reports:
	# /home/pmos/build/src/wlroots/_build
	# >>> ERROR: wlroots*: Has /home/... in rpath
	#install -D -m755 _build/rootston/rootston "$pkgdir"/usr/bin/rootston
}
sha512sums="28bc81997fba3bd685f9c57ff41f0a585cf91cd1217ae0f48133f4d6d0de580a720cfbbde1a7a9eea06e862cca6708118067710d250b6aa53e4558b1532576c2  wlroots-0_git20180524.tar.gz"
